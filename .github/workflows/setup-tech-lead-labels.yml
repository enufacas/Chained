name: "Setup Tech Lead Review Labels"

# This workflow creates the required labels for the Tech Lead Review System
# Run manually via workflow_dispatch or automatically on push to main

on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - '.github/workflows/tech-lead-review.yml'
      - '.github/workflows/setup-tech-lead-labels.yml'

permissions:
  issues: write
  pull-requests: write

jobs:
  create-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Create Tech Lead Review System labels
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "ðŸ·ï¸  Creating Tech Lead Review System labels..."
          echo "Repository: ${{ github.repository }}"
          echo ""
          
          # Function to create or update a label
          create_label() {
            local name="$1"
            local description="$2"
            local color="$3"
            
            echo "Creating label: ${name}"
            
            # Try to create the label
            if gh label create "${name}" \
              --repo "${{ github.repository }}" \
              --description "${description}" \
              --color "${color}" 2>/dev/null; then
              echo "âœ… Created: ${name}"
            else
              # If creation fails, try to update it
              if gh label edit "${name}" \
                --repo "${{ github.repository }}" \
                --description "${description}" \
                --color "${color}" 2>/dev/null; then
                echo "â™»ï¸  Updated: ${name}"
              else
                echo "â„¹ï¸  Already exists: ${name}"
              fi
            fi
            echo ""
          }
          
          # Label 1: needs-tech-lead-review (blocking label - RED)
          create_label \
            "needs-tech-lead-review" \
            "Tech Lead review is required before this PR can be merged" \
            "D73A4A"
          
          # Label 2: tech-lead-approved (approval label - GREEN)
          create_label \
            "tech-lead-approved" \
            "Tech Lead has approved this PR for merge" \
            "0E8A16"
          
          # Label 3: tech-lead-changes-requested (blocking label - YELLOW/ORANGE)
          create_label \
            "tech-lead-changes-requested" \
            "Tech Lead has requested changes to this PR" \
            "FBCA04"
          
          # Label 4: tech-lead-review-cycle (info label - BLUE)
          create_label \
            "tech-lead-review-cycle" \
            "This PR is in an active Tech Lead review iteration cycle" \
            "1D76DB"
          
          # Label 5: tech-lead:workflows-tech-lead (identifier label - PURPLE)
          create_label \
            "tech-lead:workflows-tech-lead" \
            "Assigned to workflows-tech-lead for review" \
            "5319E7"
          
          # Label 6: tech-lead:agents-tech-lead (identifier label - PURPLE)
          create_label \
            "tech-lead:agents-tech-lead" \
            "Assigned to agents-tech-lead for review" \
            "5319E7"
          
          # Label 7: tech-lead:docs-tech-lead (identifier label - PURPLE)
          create_label \
            "tech-lead:docs-tech-lead" \
            "Assigned to docs-tech-lead for review" \
            "5319E7"
          
          # Label 8: tech-lead:github-pages-tech-lead (identifier label - PURPLE)
          create_label \
            "tech-lead:github-pages-tech-lead" \
            "Assigned to github-pages-tech-lead for review" \
            "5319E7"
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… Tech Lead Review System labels are ready!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "Created/Updated labels:"
          echo "  ðŸ”´ needs-tech-lead-review (blocks merge)"
          echo "  ðŸŸ¢ tech-lead-approved (enables merge)"
          echo "  ðŸŸ¡ tech-lead-changes-requested (blocks merge)"
          echo "  ðŸ”µ tech-lead-review-cycle (tracking)"
          echo "  ðŸŸ£ tech-lead:workflows-tech-lead (identifier)"
          echo "  ðŸŸ£ tech-lead:agents-tech-lead (identifier)"
          echo "  ðŸŸ£ tech-lead:docs-tech-lead (identifier)"
          echo "  ðŸŸ£ tech-lead:github-pages-tech-lead (identifier)"
          echo ""
          echo "These labels are now active and will be used by:"
          echo "  â€¢ tech-lead-review.yml - For PR analysis and assignment"
          echo "  â€¢ auto-review-merge.yml - For merge blocking/allowing"
          echo ""
          echo "ðŸŽ¯ System Status: READY"
          echo ""

      - name: List all tech-lead labels
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "ðŸ“‹ Current Tech Lead labels in repository:"
          echo ""
          gh label list --repo "${{ github.repository }}" | grep -E "(tech-lead|Tech Lead)" || echo "No tech-lead labels found"
          echo ""

      - name: Post summary
        run: |
          echo "## ðŸ·ï¸ Tech Lead Review Labels Setup" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "The following labels have been created/updated for the Tech Lead Review System:" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Label | Color | Purpose | Blocks Merge |" >> $GITHUB_STEP_SUMMARY
          echo "|-------|-------|---------|--------------|" >> $GITHUB_STEP_SUMMARY
          echo "| \`needs-tech-lead-review\` | ðŸ”´ Red | Tech Lead review required | âœ… Yes |" >> $GITHUB_STEP_SUMMARY
          echo "| \`tech-lead-approved\` | ðŸŸ¢ Green | Approved by Tech Lead | âŒ No |" >> $GITHUB_STEP_SUMMARY
          echo "| \`tech-lead-changes-requested\` | ðŸŸ¡ Yellow | Changes requested | âœ… Yes |" >> $GITHUB_STEP_SUMMARY
          echo "| \`tech-lead-review-cycle\` | ðŸ”µ Blue | In review cycle | â„¹ï¸ Info |" >> $GITHUB_STEP_SUMMARY
          echo "| \`tech-lead:workflows-tech-lead\` | ðŸŸ£ Purple | Workflows Tech Lead | â„¹ï¸ Info |" >> $GITHUB_STEP_SUMMARY
          echo "| \`tech-lead:agents-tech-lead\` | ðŸŸ£ Purple | Agents Tech Lead | â„¹ï¸ Info |" >> $GITHUB_STEP_SUMMARY
          echo "| \`tech-lead:docs-tech-lead\` | ðŸŸ£ Purple | Docs Tech Lead | â„¹ï¸ Info |" >> $GITHUB_STEP_SUMMARY
          echo "| \`tech-lead:github-pages-tech-lead\` | ðŸŸ£ Purple | GitHub Pages Tech Lead | â„¹ï¸ Info |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **System Status:** Tech Lead Review System labels are active and ready for use." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "*ðŸ¤– Automated by @workflows-tech-lead*" >> $GITHUB_STEP_SUMMARY
