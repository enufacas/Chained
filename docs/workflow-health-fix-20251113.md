# Workflow Health Alert - Investigation & Fix

**Date:** 2025-11-13  
**Investigator:** @investigate-champion  
**Issue:** Workflow Health Alert - 21.9% failure rate

## Executive Summary

**@investigate-champion** investigated the workflow failures reported in the System Monitor alert and identified the root cause: **missing repository labels**.

Two workflows are failing consistently because they attempt to apply GitHub labels that don't exist in the repository:

1. **Chained TV Episode Generator** - 2 failures (missing `chained-tv` label)
2. **Code Quality: Analyzer** - 12 failures (missing `code-quality` label)

## Root Cause Analysis

### Failure Pattern

Both workflows successfully complete their primary tasks (generating episodes, analyzing code) but fail at the final step when trying to create Pull Requests with specific labels.

### Error Messages

**Chained TV workflow:**
```
could not add label: 'chained-tv' not found
```

**Code Analyzer workflow:**
```
could not add label: 'code-quality' not found
```

### Affected Code

**File:** `.github/workflows/chained_tv.yml`  
**Line:** 65  
**Code:**
```yaml
--label "chained-tv,automated" \
```

**File:** `.github/workflows/code-analyzer.yml`  
**Lines:** 158, 202  
**Code:**
```yaml
--label "code-quality,automated" \
# and
--label "code-quality,ai-generated" || true
```

## Impact Analysis

- **Total Runs:** 100 (sampled)
- **Completed:** 64
- **Failed:** 14
- **Failure Rate:** 21.9%
- **Threshold:** 20.0%

The failure rate exceeds the acceptable threshold, triggering the health alert.

### Why This Happens

When a workflow uses `gh pr create --label`, GitHub CLI validates that all specified labels exist in the repository. If any label is missing, the command fails with exit code 1, causing the entire workflow to fail.

## Solution

### Quick Fix

Create the following 4 missing labels in the repository:

| Label | Color | Description | Used By |
|-------|-------|-------------|---------|
| `chained-tv` | `#7B68EE` (Medium Purple) | Automated Chained TV episode generation | chained_tv.yml |
| `code-quality` | `#0E8A16` (Green) | Code quality analysis and improvements | code-analyzer.yml |
| `automated` | `#FBCA04` (Yellow) | Automated workflow-generated content | Both workflows |
| `ai-generated` | `#D4C5F9` (Light Purple) | Content generated by AI workflows | code-analyzer.yml |

### Automated Fix Script

**@investigate-champion** has created a script to automate label creation:

```bash
./scripts/create-missing-labels.sh
```

This script:
1. Checks for GitHub authentication
2. Creates all 4 missing labels
3. Handles cases where labels already exist
4. Provides clear status output

### Manual Fix

Labels can also be created manually via GitHub UI:

1. Navigate to: https://github.com/enufacas/Chained/labels
2. Click "New label"
3. Create each label with the specifications above

## Expected Outcome

After creating these labels:

- ✅ Chained TV workflow will complete successfully
- ✅ Code Analyzer workflow will complete successfully
- ✅ Failure rate will drop below 20%
- ✅ PRs will be properly categorized with labels
- ✅ No workflow logic changes needed

## Testing

To verify the fix:

1. Run the label creation script
2. Manually trigger the Chained TV workflow
3. Manually trigger a merge to main (triggers Code Analyzer)
4. Verify both workflows complete without label errors
5. Check that created PRs have the correct labels

## Prevention

### Best Practices

To prevent similar issues in the future:

1. **Label Validation:** Add a CI check to validate required labels exist
2. **Graceful Degradation:** Consider using `|| true` on label assignment
3. **Documentation:** Document required labels in repository README
4. **Setup Scripts:** Include label creation in repository setup scripts

### Monitoring

The System Monitor workflow (`.github/workflows/system-monitor.yml`) will continue to track workflow health and alert if failure rates exceed 20%.

## Timeline

- **2025-11-13 06:22:01 UTC** - System Monitor detected 21.9% failure rate
- **2025-11-13 06:34:00 UTC** - @investigate-champion began investigation
- **2025-11-13 06:45:00 UTC** - Root cause identified (missing labels)
- **2025-11-13 06:50:00 UTC** - Fix script created and documented

## References

- **Issue:** #596 (Workflow Health Alert - 2025-11-13)
- **Affected Workflows:**
  - `.github/workflows/chained_tv.yml`
  - `.github/workflows/code-analyzer.yml`
- **Fix Script:** `scripts/create-missing-labels.sh`
- **System Monitor:** `.github/workflows/system-monitor.yml`

## Conclusion

**@investigate-champion** has identified a straightforward fix for the workflow failures. Creating 4 missing repository labels will resolve 100% of the reported failures without requiring any workflow logic changes.

The issue is not caused by workflow bugs but by incomplete repository configuration. Once the labels are created, both workflows will function as designed.

---

*Investigation completed by **@investigate-champion** following the investigate-champion specialization in code analysis and metrics investigation.*
